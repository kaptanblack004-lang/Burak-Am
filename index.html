<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>FLAPPY AGRESSIVE EDITION</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; touch-action: none; }
        canvas { display: block; margin: 0 auto; }
        
        #ui-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
        }

        #score-display {
            text-align: center; color: white; font-size: 60px; font-weight: 900;
            margin-top: 20px; text-shadow: 0 0 20px #ff0055;
        }

        /* GAME OVER EKRANI */
        #game-over-screen {
            display: none; position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.92);
            pointer-events: auto; flex-direction: column;
            justify-content: center; align-items: center; padding: 20px;
        }

        #game-over-screen img { 
            width: 85%; max-width: 320px; border-radius: 20px; 
            border: 4px solid #0ff; margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }

        .score-info { color: #fff; font-size: 24px; margin-bottom: 30px; }

        /* İSTEDİĞİN O MEŞHUR BUTON */
        #mega-retry-btn {
            width: 90%; max-width: 380px; height: 110px;
            background: linear-gradient(135deg, #ff0055 0%, #ff5500 100%);
            color: white; border: none; border-radius: 20px;
            font-size: 22px; font-weight: 900; cursor: pointer;
            box-shadow: 0 10px 0 #990033, 0 15px 30px rgba(255, 0, 85, 0.4);
            display: flex; justify-content: center; align-items: center;
            text-align: center; text-transform: uppercase;
            letter-spacing: 1px; transition: transform 0.1s;
        }
        
        #mega-retry-btn:active { 
            transform: translateY(6px); 
            box-shadow: 0 4px 0 #990033;
            background: #fff; 
            color: #ff0055; 
        }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="ui-layer">
    <div id="score-display">0</div>
    <div id="game-over-screen">
        <img src="https://i.imgur.com/GqDuolU.jpeg" alt="Yandın">
        <div class="score-info">TOPLAM SKOR: <span id="final-score">0</span></div>
        <button id="mega-retry-btn">KAFASINI SİKTİĞİM<br>TEKRAR DENE</button>
    </div>
</div>

<script>
const cvs = document.getElementById("gameCanvas");
const ctx = cvs.getContext("2d");
const scoreText = document.getElementById("score-display");
const overScreen = document.getElementById("game-over-screen");
const retryBtn = document.getElementById("mega-retry-btn");
const finalScoreText = document.getElementById("final-score");

// Mobil Uyumluluk Ayarı
let w = window.innerWidth > 450 ? 420 : window.innerWidth;
let h = window.innerHeight;
cvs.width = w; cvs.height = h;

const birdImg = new Image(); birdImg.src = "https://i.imgur.com/9sZhySO.jpeg";

let bird, pipes, score, frame, isAlive;
const gravity = 0.35, jumpForce = -6.5;

function start() {
    bird = { x: 60, y: h/2, w: 50, h: 50, v: 0 };
    pipes = [];
    score = 0;
    frame = 0;
    isAlive = true;
    scoreText.innerText = "0";
    overScreen.style.display = "none";
}

function die() {
    isAlive = false;
    finalScoreText.innerText = score;
    overScreen.style.display = "flex";
}

function update() {
    if(!isAlive) return;

    bird.v += gravity;
    bird.y += bird.v;

    if(frame % 85 === 0) {
        let gap = 180;
        let t = Math.random() * (h - gap - 200) + 100;
        pipes.push({ x: w, t: t, g: gap, passed: false });
    }

    pipes.forEach((p, i) => {
        p.x -= 3.5;
        // Çarpışma Kutusu (Hassas ayar)
        if(bird.x + 8 < p.x + 65 && bird.x + bird.w - 8 > p.x && 
          (bird.y + 8 < p.t || bird.y + bird.h - 8 > p.t + p.g)) die();

        if(!p.passed && p.x < bird.x) {
            score++;
            p.passed = true;
            scoreText.innerText = score;
        }
        if(p.x < -80) pipes.splice(i, 1);
    });

    if(bird.y > h || bird.y < -150) die();
    frame++;
}

function draw() {
    ctx.fillStyle = "#000"; // Arka plan siyah
    ctx.fillRect(0, 0, w, h);

    // Borular
    pipes.forEach(p => {
        ctx.fillStyle = "#ff0055";
        ctx.fillRect(p.x, 0, 65, p.t);
        ctx.fillRect(p.x, p.t + p.g, 65, h);
    });

    // Kuş ve Rotasyon
    ctx.save();
    ctx.translate(bird.x + bird.w/2, bird.y + bird.h/2);
    ctx.rotate(Math.min(Math.PI/4, Math.max(-Math.PI/4, bird.v * 0.1)));
    ctx.drawImage(birdImg, -bird.w/2, -bird.h/2, bird.w, bird.h);
    ctx.restore();

    update();
    requestAnimationFrame(draw);
}

// BUTONUN ÇALIŞMASINI GARANTİLEYEN KISIM
retryBtn.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    e.stopPropagation();
    start();
});

// Zıplama Kontrolü
const handleAction = (e) => {
    if(!isAlive) return;
    if(e.type === 'touchstart') e.preventDefault();
    bird.v = jumpForce;
};

window.addEventListener("pointerdown", (e) => {
    if(e.target.id !== "mega-retry-btn") handleAction(e);
});
window.addEventListener("keydown", (e) => { if(e.code === "Space") handleAction(e); });

birdImg.onload = () => {
    start();
    draw();
};
</script>
</body>
</html>
